{% block content %}
    <!-- Section d'affichage des tickets -->
    <section class="tickets-list">
        {% if tickets %}
            {% for ticket in tickets %}
                <article class="tickets-list__ticket">
                    <p class="ticket__user">{{ ticket.user }} a demandé une critique</p>
                    <time class="ticket__time">{{ ticket.time_created }}</time>
                    <h2 class="ticket__title">{{ ticket.title }}</h2>
                    <p class="ticket__description">{{ ticket.description }}</p>

                    {% if ticket.photo %}
                        <img class="ticket__image" src="{{ ticket.photo.image.url }}" alt="Photo du billet">
                    {% endif %}

                    {% if show_buttons and ticket.user == request.user %}
                    <a href="{% url 'edit_ticket' ticket.id %}" class="btn btn-primary">Modifier</a>
                    <!-- A corriger -->
                    <form method="post" action="{% url 'edit_ticket' ticket.id %}">
                        {{ delete_form }}
                        {% csrf_token %}
                        <button type="submit" name = "delete_ticket" class="btn btn-secondary">Supprimer</button>
                    </form>
                    {% endif %}

                    <!-- Affichage de la critique associée -->
                    {% if ticket.review_set.all %}
                        <section class="ticket__review">
                            {% for review in ticket.review_set.all %}
                                <div class="review">
                                    <header class="review__header">
                                        <p>Critique de {{ review.user }}</p>
                                        <time datetime="{{ review.time_created|date:'c' }}">{{ review.time_created|date:'H:i, d F Y' }}</time>
                                    </header>
                                    <h3 class="review__headline">{{ review.headline }}</h3>
                                    <p class="review__rating">Note : {{ review.rating }} ★</p>
                                    <p class="review__body">{{ review.body }}</p>
                                </div>
                            {% endfor %}
                        </section>
                    {% else %}
                       <button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'create-review' ticket.id %}'">Créer une critique</button>
                    {% endif %}
                </article>
            {% endfor %}
        {% else %}
            <p>Aucun ticket n'a été créé pour l'instant.</p>
        {% endif %}
    </section>
{% endblock content %}